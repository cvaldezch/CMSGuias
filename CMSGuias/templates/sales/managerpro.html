{% extends "base.html" %}
{% block title %}
    Manager Project
{% endblock title %}
{% block style %}
    <link rel="stylesheet" href="{{ MEDIA_URL }}css/sales/managerpro.css">
    <link rel="stylesheet" href="{{ MEDIA_URL }}css/chosen.css">
{% endblock style %}
{% block script %}
    <script src="{{ MEDIA_URL }}js/tinymce.js"></script>
    <script src="{{ MEDIA_URL }}js/mustache.js"></script>
    <script src="{{ MEDIA_URL }}js/sales/managerpro.js"></script>
    <script src="{{ MEDIA_URL }}js/checkbox.min.js"></script>
    <script src="{{ MEDIA_URL }}js/chosen.jquery.min.js"></script>
    <script src="{{ MEDIA_URL }}js/mailer.js"></script>
    <script>
    equalheight = function(container){
        var currentTallest = 0,
        currentRowStart = 0,
        rowDivs = new Array(),
        $el,
        topPosition = 0;
        $(container).each(function() {
            $el = $(this);
            $($el).height('auto')
            topPostion = $el.position().top;

            if (currentRowStart != topPostion) {
                for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
                rowDivs[currentDiv].height(currentTallest);
            }
            rowDivs.length = 0; // empty the array
            currentRowStart = topPostion;
            currentTallest = $el.height();
                rowDivs.push($el);
            } else {
                rowDivs.push($el);
                currentTallest = (currentTallest < $el.height()) ? ($el.height()) : (currentTallest);
            }
            for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
                rowDivs[currentDiv].height(currentTallest);
            }
        });
    }
    $(window).load(function() {
        equalheight('.all-sectors article');
    });
    $(window).resize(function(){
        equalheight('.all-sectors article');
    });
    </script>
{% endblock script %}
{% block menu %}
    {% if user.get_profile.empdni.charge.area|lower == 'ventas' or user.get_profile.empdni.charge.area|lower == 'administrator' %}
        {% include "menus/sale.htm" %}
    {% endif %}
    {% if user.get_profile.empdni.charge.area|lower == 'logistica' %}
        {% include "menus/logistics.htm" %}
    {% endif %}
    {% if user.get_profile.empdni.charge.area|lower == 'operaciones' %}
        {% include "menus/operations.htm" %}
    {% endif %}
    {% if user.get_profile.empdni.charge.area|lower == 'almacen' %}
        {% include "menus/storage_menu.htm" %}
    {% endif %}
{% endblock menu %}
{% block content %}
    <div class="container">
        <div class="well">
            <h3>
                Administrador de Proyecto {{ project.nompro }}
                <br>
                <small>Cliente: {{ project.ruccliente_id }} - {{ project.ruccliente.razonsocial }}</small>
                <br>
                <a href="{% url 'view_projects' %}" class="btn btn-default btn-xs">
                    <span class="glyphicon glyphicon-chevron-left"></span> Regresar
                </a>
            </h3>
            <div class="row">
                <div class="col-md-3">
                    <div class="panel panel-primary panel-manager">
                        <div class="panel-body">
                            <h4>Sectores y Subproyectos</h4>
                            <hr>
                            <div class="panel-group" id="accordion">
                                <div class="panel panel-primary sector-default">
                                    <div class="panel-heading">
                                        <h4 class="panel-title">
                                            <a data-toggle="collapse" data-parent="#accordion" href="#default">
                                              Proyecto Default
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="default" class="panel-collapse collapse in">
                                      <div class="panel-body">
                                        <ul class="sectors sectorsdefault">
                                            {% for x in sectors %}
                                                {% ifequal x.subproyecto_id None %}
                                                    <li>
                                                        <a href="{% url 'managersec_view' x.proyecto_id x.subproyecto_id x.sector_id %}" class="text-black">
                                                            <span class="glyphicon glyphicon-chevron-right"></span>
                                                            {{ x.nomsec }}
                                                        </a>
                                                    </li>
                                                {% endifequal %}
                                            {% endfor %}
                                        </ul>
                                      </div>
                                    </div>
                                </div>
                                {% for x in subpro %}
                                    <div class="panel panel-primary" data-sub="{{ x.subproyecto_id }}">
                                        <div class="panel-heading">
                                          <h5 class="panel-title">
                                            <a class="text-{{ x.subproyecto_id }}" data-toggle="collapse" data-parent="#accordion" href="#{{ x.subproyecto_id }}">
                                                {{ x.nomsub }}
                                            </a>
                                          </h5>
                                        </div>
                                        <div id="{{ x.subproyecto_id }}" class="panel-collapse collapse">
                                        {% if user.get_profile.empdni.charge.area|lower == 'administrator' or user.get_profile.empdni.charge.area|lower == 'ventas' %}
                                            <div class="panel-footer">
                                                <div class="btn-group btn-group-justified">
                                                    <div class="btn-group">
                                                        <button class="btn btn-xs btn-default text-black btn-edit-sub" value="{{ x.subproyecto_id }}"><span class="glyphicon glyphicon-pencil"></span></button>
                                                    </div>
                                                    <div class="btn-group">
                                                        <button class="btn btn-xs btn-default text-black btn-del-sub" value="{{ x.subproyecto_id }}"><span class="glyphicon glyphicon-trash"></span></button>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                            <div class="panel-body">
                                                <ul class="sectors sectors{{ x.subproyecto_id }}">
                                                    {% for j in sectors %}
                                                        {% ifequal x.subproyecto_id j.subproyecto_id  %}
                                                            <li><a href="{% url 'managersec_view' j.proyecto_id j.subproyecto_id j.sector_id %}" class="text-black"><span class="glyphicon glyphicon-chevron-right"></span> {{ j.nomsec }}</a></li>
                                                        {% endifequal %}
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="panel panel-primary panel-manager">
                        <div class="panel-body">
                            <input type="hidden" name="pro" value="{{ project.proyecto_id }}" data-name="{{ project.nompro }}" data-address="{{ project.direccion }}" data-responsible="{{ project.empdni.name_complete }}" data-customers="{{ project.ruccliente.razonsocial }}" data-star="{{ project.comienzo }}" data-end="{{ project.fin }}">
                            <input type="hidden" name="sub" value="">
                            <div class="header-project">
                                <p>
                                    <strong>Proyecto :</strong> {{ project.nompro }}
                                    <strong> Codigo :</strong> {{ project.proyecto_id}}
                                </p>
                                <p>
                                    <strong>Dirección: </strong> {{ project.direccion }} - {{ project.distrito.distnom }}  - {{ project.provincia.pronom }} - {{ project.departamento.depnom }} - {{ project.pais.paisnom }}
                                </p>
                                <p class="contact-project">
                                    <strong>Contacto:</strong> {{ project.contact }}
                                </p>
                                {% if project.empdni_id %}
                                    <p>
                                        <strong>Responsable :</strong> {{ project.empdni.name_complete }} {{ project.empdni.name_charge }}
                                    </p>
                                {% endif %}
                            </div>
                            <div class="btn-group btn-group-justified">
                                {% if user.get_profile.empdni.charge.area|lower == 'administrator' or user.get_profile.empdni.charge.area|lower == 'ventas' %}
                                    {% if project.status == 'PE' or project.status == 'AC' %}
                                        <div class="btn-group">
                                            <button class="btn btn-primary btn-xs new-sector">
                                                <span class="glyphicon glyphicon-th"></span>
                                                <span class="visible-lg visible-md">Nuevo Sector</span>
                                            </button>
                                        </div>
                                    {% endif %}
                                    {% if project.status == 'PE' or project.status == 'AC' %}
                                        <div class="btn-group">
                                            <button class="btn btn-primary btn-xs new-subproject">
                                            <!-- {#% if project.status == 'AC' %}
                                                hide
                                            {% endif %#}"> -->
                                                <span class="fa fa-code-fork"></span>
                                                <span class="visible-lg visible-md">Nuevo Subproyeto</span>
                                            </button>
                                        </div>
                                    {% endif %}
                                {% endif %}

                                <div class="btn-group">
                                    <button type="button" class="btn btn-xs btn-primary dropdown-toggle" data-toggle="dropdown">
                                        <span class="fa fa-cubes"></span>
                                        <span class="visible-lg visible-lg">Acciones</span>
                                    </button>
                                    <ul class="dropdown-menu text-left" role="menu">
                                        {% if request.user.get_profile.empdni.charge.area|lower == 'administrator' or request.user.get_profile.empdni.charge.area|lower == 'operaciones' %}
                                            <li class="text-left">
                                                <button type="Button" class="btn btn-link btn-xs text-black btn-close-project" data-toggle="modal" data-target="#closeProject">
                                                    <span class="fa fa-check-circle"></span>
                                                    <!-- <span class="fa fa-star-half-o"></span> -->
                                                    <span class="glyphicon-class">Terminar Proyecto</span>
                                                </button>
                                            </li>
                                        {% endif %}
                                        <!-- load file materials -->
                                        {% if request.user.get_profile.empdni.charge.area|lower == 'ventas' or request.user.get_profile.empdni.charge.area|lower == 'administrator' %}
                                            <li>
                                                <button type="button" class="btn btn-link btn-xs text-black btn-prices-list pull-left" data-toggle="modal" data-target="#mlprices">
                                                    <span class="fa fa-file-excel-o"></span>
                                                    <span class="glyphicon-class">Cargar Precios</span>
                                                </button>
                                            </li>
                                        {% endif %}
                                        {% if project.status == 'AC' %}
                                            {% if request.user.get_profile.empdni.charge.area|lower == 'ventas' or  request.user.get_profile.empdni.charge.area|lower == 'logistica' or  request.user.get_profile.empdni.charge.area|lower == 'administrator' %}
                                                <li>
                                                    <a href="{% url 'compressed_list' project.proyecto_id %}" class="btn btn-link btn-xs text-black btn-compress-list">
                                                        <span class="fa fa-list-alt"></span>
                                                        <span class="glyphicon glyphicon-compressed"></span>
                                                        <span class="glyphicon-class">Lista Materiales</span>
                                                    </a>
                                                </li>
                                            {% endif %}
                                        {% endif %}
                                        {% if project.status == 'AC' and request.user.get_profile.empdni.charge.cargos|lower == 'jefe de operaciones' or  request.user.get_profile.empdni.charge.area|lower == 'administrator' %}
                                            <li>
                                                <button class="btn btn-link btn-xs text-black btn-responsible">
                                                    <span class="glyphicon glyphicon-user"></span>
                                                    <span class="glyphicon-class">Responsable</span>
                                                </button>
                                            </li>
                                        {% endif %}
                                        {% if project.status != 'AC' or request.user.get_profile.empdni.charge.area|lower == 'administrator' or  request.user.get_profile.empdni.charge.area|lower == 'ventas' %}
                                            <li>
                                                <button class="btn btn-link btn-xs text-black btn-files">
                                                    <span class="glyphicon glyphicon-compressed"></span>
                                                    <span class="glyphicon-class">Archivos</span>
                                                </button>
                                            </li>
                                        {% if project.status != 'AC' or request.user.get_profile.empdni.charge.area|lower == 'administrator' or user.get_profile.empdni.charge.area|lower == 'ventas' %}
                                            <li>
                                                <button class="btn btn-link btn-xs text-black btn-emails">
                                                    <span class="glyphicon glyphicon-send"></span>
                                                    <span class="glyphicon-class">Correo Apertura</span>
                                                </button>
                                            </li>
                                        {% endif %}
                                        {% if project.status == 'AC' %}
                                            <li>
                                                <button class="btn btn-link btn-sm text-black btn-show-guides">
                                                    <span class="fa fa-tasks"></span>
                                                    <span>Guias de Remisión</span>
                                                </button>
                                            </li>
                                        {% endif %}
                                        {% endif %}
                                    </ul>
                                </div>
                                {% if project.status != 'AC' %}
                                    <div class="btn-group">
                                        <button data-toggle="modal" data-target="#mapprove" class="btn btn-danger btn-xs btn-approve">
                                            <span class="glyphicon glyphicon-saved"></span>
                                            <span class="visible-lg visible-sm">Aprobar</span>
                                        </button>
                                    </div>
                                {% endif %}
                                <div class="btn-group">
                                    <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown">
                                        <span class="caret"></span>
                                        <span class="visible-lg visible-md">Vista</span>
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li>
                                            <a class="btn-cuadro"><span class="glyphicon glyphicon-th"></span> Cuadros</a></li>
                                        <li>
                                            <a class="btn-list"><span class="glyphicon glyphicon-align-justify"></span> Lista</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <hr>
                            <div class="all-sectors">
                                {% for x in sectors %}
                                    {% ifequal x.subproyecto_id None  %}
                                        <article>
                                            {% if request.user.get_profile.empdni.charge.area|lower == 'administrator' or project.status != 'AC' %}
                                                <button class="btn btn-xs text-black btn-link pull-left btn-edit-sector"
                                                value="{{ x.sector_id }}">
                                                    <span class="glyphicon glyphicon-pencil"></span>
                                                </button>
                                            {% endif %}
                                            <button class="btn btn-xs text-black btn-link pull-right
                                            {% if project.status == 'AC' %}
                                                hide
                                            {% endif %}
                                            " value="{{ x.sector_id }}">
                                                <span class="glyphicon glyphicon-trash"></span>
                                            </button>
                                            <a href="{% url 'managersec_view' x.proyecto_id x.subproyecto_id x.sector_id %}" class="text-black">
                                                {{ x.sector_id }}
                                                {{ x.nomsec }}
                                                <small>{{ x.planoid }}</small>
                                            </a>
                                        </article>
                                    {% endifequal %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="panel panel-default panel-comment comment-list">
                                <div class="panel-heading   ">
                                    <h6>Comentarios</h6>
                                    <button class="close btn-show-comment"><span class="glyphicon glyphicon-chevron-up"></span></button>
                                </div>
                                <div class="panel-body">
                                    {% for x in alerts %}
                                        <div class="alert alert-{{ x.status }} comment{{ x.id }}">
                                                <div>
                                                    {% ifequal x.empdni_id user.get_profile.empdni_id %}
                                                        <div class="btn-group pull-right">
                                                            <button type="button" data-toggle="dropdown" class="btn btn-xs btn-link text-black dropdown-toggle"><span class="glyphicon glyphicon-collapse-down"></span></button>
                                                            <ul role="menu" class="dropdown-menu">
                                                                <li><a data-status="{{ x.status }}" data-id="{{ x.id }}" class="btn-message-edit">Editar</a></li>
                                                                <!-- <li><a data-status="{{ x.status }}" data-id="{{ x.id }}" class="btn-message-del">Eliminar</a></li> -->
                                                            </ul>
                                                        </div>
                                                    {% endifequal %}
                                                    <small>{{ x.registrado }}</small>
                                                </div>
                                                <div>
                                                    {{ x.message|safe }}
                                                </div>
                                                <div>
                                                    <small class="pull-right">{{ x.empdni.firstname }} {{ x.empdni.lastname }} - {{ x.charge.area }}</small>
                                                </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="panel panel-default panel-comment">
                                <div class="panel-heading">
                                    <h6>Publicar Comentario</h6>
                                </div>
                                <div class="panel-body">
                                    <textarea maxlength="250" name="message" id="message" rows="1" class="form-control"></textarea>
                                    <div class="form-group">
                                        <select name="message-status" id="message-status" class="form-control">
                                            <option value="success">Normal</option>
                                            <option value="warning">Importante</option>
                                            <option value="danger">Urgente</option>
                                        </select>
                                    </div>
                                    <input type="hidden" name="edit-message">
                                    <button class="btn btn-success bt-sm btn-publisher">
                                        <span class="glyphicon glyphicon-comment"></span> Publicar
                                    </button>
                                    <input type="checkbox" name="mailer-enable" data-off-label="false" data-on-label="false" data-off-icon-class="fa fa-times" data-on-icon-class="fa fa-envelope-o" data-on-class="btn-primary" data-style="btn-group-sm pull-right">
                                    <span>
                                        <h6><small> Maximo de caracteres 250.</small></h6>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="row">
                        {% if user.get_profile.empdni.charge.area|lower == 'administrator' or user.get_profile.empdni.charge.area|lower == 'ventas' or user.get_profile.empdni.charge.area|lower == 'logistica' or user.get_profile.empdni.charge.cargos|lower == 'jefe de operaciones' %}
                        <div class="col-md-6">
                            <div class="panel panel-primary">
                                <div class="panel-footer">
                                    <strong>Archivos Administrativos</strong>
                                </div>
                                <div class="panel-body">
                                    <div id="filetree_administrative"></div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        <div class="col-md-6">
                            <div class="panel panel-primary">
                                <div class="panel-footer">
                                    <strong>Archivos Operaciones</strong>
                                </div>
                                <div class="panel-body">
                                    <div id="filetree_operation"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% if user.get_profile.empdni.charge.area|lower == 'administrator' or user.get_profile.empdni.charge.area|lower == 'ventas' or user.get_profile.empdni.charge.cargos|lower == 'jefe de operaciones' or user.get_profile.empdni.charge.area|lower == 'logistica' %}
                    <div class="col-md-12">
                        <div class="panel panel-success panel-letter">
                            <div class="panel-heading">
                                <h4>
                                    Lista de Cartas
                                    <button class="btn btn-xs btn-success text-black btn-show-letter">
                                        <span class="fa fa-plus"></span>
                                    </button>
                                </h4>
                                <button class="btn btn-lg btn-link close btn-letter-toggle">
                                    <span class="glyphicon glyphicon-chevron-up"></span>
                                </button>
                                <!-- <span class="close fa fa-chevron-down"></span> -->
                            </div>
                            <div class="table-responsive">
                                <table class="table table-condensed table-hover table-letter">
                                    <thead>
                                        <tr class="success">
                                            <th class="col-1">Item</th>
                                            <th class="text-center">Código</th>
                                            <th class="">De</th>
                                            <th class="">Para</th>
                                            <th class="text-center">Estado</th>
                                            <th class="text-center">Carta</th>
                                            <th class="text-center">Acción</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% if user.get_profile.empdni.charge.area|lower == 'administrator' or user.get_profile.empdni.charge.area|lower == 'ventas' or user.get_profile.empdni.charge.area|lower == 'logistica' %}
                    <div class="col-md-12">
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                <h4>
                                    Ordenes de Compra
                                    {% if user.get_profile.empdni.charge.area|lower == 'administrator' or user.get_profile.empdni.charge.area|lower == 'ventas' %}
                                    <button class="btn btn-lg btn-link text-primary btn-add-purchase-order">
                                        <span class="glyphicon glyphicon-plus-sign"></span>
                                    </button>
                                    <input type="hidden" name="editpurchse">
                                    {% endif %}
                                </h4>
                                <button class="btn btn-lg btn-link close btn-re-purchase-order pull-left">
                                    <span class="glyphicon glyphicon-refresh"></span>
                                </button>
                                <button class="btn btn-lg btn-link close btn-sh-purchase-order">
                                    <span class="glyphicon glyphicon-chevron-down"></span>
                                </button>
                            </div>
                            <table class="table table-hover tpurchase">
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
<!-- block modal -->
<div class="modal fade mpurchase" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4 class="modal-title">Orden de Compra</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">N de Documento</label>
                            <input type="text" maxlength="14" name="pond" class="form-control input-sm" placeholder="Nro Documento">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Fecha de Emisión</label>
                            <input type="text" class="form-control input-sm" name="podt" placeholder="aaaa-mm-dd">
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group">
                            <label class="control-label">Moneda</label>
                            <select name="pocu" class="form-control input-sm">
                                {% for x in currency %}
                                    <option value="{{ x.moneda_id }}">{{ x.moneda }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Documento</label>
                            <select name="podc" class="form-control input-sm">
                                {% for x in document %}
                                    <option value="{{ x.documento_id }}">{{ x.documento }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Con. de Pago</label>
                            <select name="popy" class="form-control input-sm">
                                {% for x in method %}
                                    <option value="{{ x.pagos_id }}">{{ x.pagos }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Orden de Compra (Digital opcional)</label>
                            <input type="file" class="form-control upfile" accept="application/pdf">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <button class="btn btn-link text-green btn-details-purchare-order-toggle">
                            <span class="glyphicon glyphicon-plus-sign"></span>
                            <span class="glyphicon-class">Agregar Detalle</span>
                        </button>
                        <div class="panel panel-default panel-purchase-order-toggle">
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="form-group">
                                        <input type="text" class="form-control input-sm" name="podd" placeholder="Descripción" title="Descripción">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <select name="podu" class="form-control input-sm">
                                            {% for x in unit %}
                                                <option value="{{ x.unidad_id }}">{{ x.uninom }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" class="form-control input-sm" name="podf" placeholder="aaaa-mm-dd" title="aaaa-mm-dd" maxlength="10">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" class="form-control input-sm" name="podq" placeholder="Cantidad" title="Cantidad">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" class="form-control input-sm" name="podp" placeholder="Precio" title="Precio">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="hidden" name="podedit">
                                        <button class="btn btn-sm btn-success text-black btn-add-purchase-order-details">
                                            <span class="glyphicon glyphicon-plus"></span>
                                            Agregar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="table-responsive" style="max-height: 250px; overflow: auto;">
                            <table class="table table-condensed table-hover table-bordered table-details-purchase-order">
                                <thead>
                                    <th>Item</th>
                                    <th>Descripción</th>
                                    <th>Unidad</th>
                                    <th>Fecha Entrega</th>
                                    <th width="2cm">Cantidad</th>
                                    <th>Precio</th>
                                    <th>Importe</th>
                                    <th>Editar</th>
                                    <th>Eliminar</th>
                                </thead>
                                <tbody></tbody>
                                <tfoot>
                                    <tr>
                                       <th colspan="5"></th>
                                       <th class="h6">SUBTOTAL</th>
                                       <th class="pos text-right"></th>
                                    </tr>
                                    <tr>
                                        <th colspan="4"></th>
                                        <th>
                                            <div class="input-group input-group-sm poids">
                                                <input type="number" name="poids" step="any" min="0" max="100" class="form-control input-sm text-right" value="0" placeholder="Descuento">
                                                <span class="input-group-addon">
                                                    %
                                                </span>
                                            </div>
                                        </th>
                                        <th class="h6">DSCT <span class="pods">0%</span></th>
                                        <th class="pod text-right"></th>
                                    </tr>
                                    <tr>
                                        <th colspan="5" rowspan="2" class="literal-amount h6"></th>
                                        <th class="h6">IGV <span class="povigv">{{ conf.igv }}%</span></th>
                                        <th class="poi text-right"></th>
                                    </tr>
                                    <tr>
                                        <th class="h6">TOTAL</th>
                                        <th class="pot text-right"></th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">Observacióm</label>
                            <textarea name="obser" id="obser" rows="1" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button data-dismiss="modal" class="btn btn-default pull-left">
                    <span class="glyphicon glyphicon-remove"></span>
                    Cancelar
                </button>
                <button class="btn btn-primary btn-saved-purchase">
                    <span class="glyphicon glyphicon-saved"></span>
                    Guardar Cambios
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade mresponsible">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4 class="modal-title">Responsable de proyecto.</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="control-label">Operaciones</label>
                    <select name="responsible" id="responsible" class="form-control input-sm">
                        {% for x in operation %}
                            <option value="{{ x.empdni_id }}">{{ x.name_complete }}</option>
                        {% empty %}
                            <option value="">-- Nothing --</option>
                        {% endfor %}
                    </select>
                </div>
                <!-- <div class="form-group">
                    <label class="control-label">Administrador</label>
                    <select name="admin" id="admin" class="form-control input-sm">
                        {#% for x in admin %#}
                            <option value="{{ x.empdni_id }}">{{ x.name_complete }}</option>
                        {#% empty %#}
                            <option value="">-- Nothing --</option>
                        {#% endfor %#}
                    </select>
                </div> -->
                <div class="form-group">
                    <label class="control-label">Código de Confirmación</label>
                    <input type="text" class="form-control input-sm" name="passwd" maxlength="6">
                </div>
                <div class="form-group">
                    <button class="btn btn-xs btn-link text-black btn-gen-responsible">
                        <span class="fa fa-key"></span>
                        <span class="glyphicon-class">Generar Código</span>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button data-dismiss="modal" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span> Cancelar</button>
                <button class="btn btn-primary btn-assigned"><span class="glyphicon glyphicon-floppy-disk"></span> Guardar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade mfiles" data-backdrop="static">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4>Subir Archivos</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="control-label">Administrativos</label>
                    <div class="alert alert-inverse alert-inverse-border alert-block text-center">
                        <button class="btn btn-xs btn-link btn-admin">Click Aquí</button>
                        <input type="file" class="hide" name="administrative">
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label">Operaciones</label>
                    <div class="alert alert-inverse alert-inverse-border alert-block text-center">
                        <button class="btn btn-xs btn-link btn-opera">Click Aquí</button>
                        <input type="file" class="hide" name="operation">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button data-dismiss="modal" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span> Cancelar</button>
                <button class="btn btn-primary btn-upload-files"><span class="glyphicon glyphicon-upload"></span> Subir</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade mapprove" id="mapprove" data-backdrop="static">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header brand-danger">
                <h4 class="modal-title">
                    Aprobar Proyecto para Ejecución
                </h4>
            </div>
            <div class="modal-body brand-danger">
                <p>
                    <strong>Importante!</strong> este paso solo se debe seguir si esta seguro que a terminado de ingresar los archivos y las listas de materiales a los respectivos sectores.
                </p>
                <p>
                    Desea continuar con la aprobación del proyecto?
                </p>
                <p>
                    <!-- <div class="form-group">
                        <label class="control-label">Administrador</label>
                        <select name="admin-approve" id="admin-approve" class="form-control input-sm">
                            {% for x in admin %}
                                <option value="{{ x.empdni_id }}">{{ x.name_complete }}</option>
                            {% empty %}
                                <option value="">-- Nothing --</option>
                            {% endfor %}
                        </select>
                    </div> -->
                    <div class="form-group">
                        <label class="control-label">Código de Confirmación</label>
                        <input type="text" class="form-control input-sm" name="passwd-approve" maxlength="6">
                    </div>
                    <div class="form-group">
                        <button class="btn btn-xs btn-link text-black btn-gen-approved">
                            <span class="fa fa-key"></span>
                            <span class="glyphicon-class">Generar Código</span>
                        </button>
                    </div>
                </p>
                <p>
                    <button data-dismiss="modal" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span> Cancelar</button>
                    <button class="btn btn-danger pull-right btn-approved"><span class="glyphicon glyphicon-saved"></span> Aprobar</button>
                </p>
            </div>
        </div>
    </div>
</div>
<!-- modal load prices -->
<div class="modal fade" id="mlprices">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4 class="modal-title">Cargar Hoja de Cantidad y Precios</h4>
            </div>
            <div class="modal-body">
                <div class="alert alert-inverse alert-inverse-border text-center">
                    <!-- <a href=""> -->
                        <button class="btn btn-sm upload-green text-white btn-show-loadprices">
                            <strong class="">SELECCIONAR</strong>
                        </button>
                        <span class="fa fa-paperclip fa-lg"></span>
                    <!-- </a> -->
                </div>
                <input type="file" name="fileprices" class="hide" accept="application/excel">
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-default btn-sm pull-left">
                    <span class="fa fa-times"></span>
                    Cancelar
                </button>
                <button class="btn btn-primary btn-sm" name="upload-prices" type="Button">
                    <span class="fa fa-upload"></span>
                    Cargar Archivo
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="statusproject">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-body">
                <a data-dismiss="modal" class="close">&times;</a>
                <p>
                    Cambia el estado el proyecto a instalación terminada, para que el área de contabilidad pueda realizar la documentacion respectivas.
                </p>
                <p>
                    <select name="statusp" id="statusp" class="form-control input-sm">
                        <option value="">--Seleccione--</option>
                        <option value="FC">Instalación Terminada</option>
                    </select>
                </p>
                <p>
                    <input type="password" class="form-control input-sm" placeholder="Password">
                </p>
                <p class="text-right">
                    <button class="btn btn-danger btn-sm">
                        <span class="fa fa-user"></span>
                        Confirmar
                    </button>
                </p>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" data-backdrop="static" id="letter">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4 class="modal-title">
                    Generar nueva carta
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">De</label>
                            <input type="text" class="form-control input-sm" name="letter-from" placeholder="Quién envia?" value="{{ request.user.get_profile.empdni.name_complete }}">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">Para</label>
                            <input type="text" class="form-control input-sm" name="letter-to" placeholder="Quién recibe?">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">Estado</label>
                            <select class="form-control input-sm" name="letter-status" placeholder="Estado">
                                <!-- <option value="">--Estado--</option> -->
                                <option value="PE">Pendiente</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">Observación</label>
                            <textarea name="letter-observation" rows="2" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-default btn-sm pull-left">
                    <span class="fa fa-times"></span>
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary btn-sm generate-letter">
                    <span class="fa fa-save"></span>
                    Generar Código
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="letter-upload">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4><span>Cargar Carta</span></h4>
            </div>
            <div class="modal-body">
                <div class="panel panel-primary">
                    <div class="panel-footer text-center">
                        <button type="button" class="btn btn-link text-black btn-open-letter-file">
                            <span class="fa fa-paperclip fa-lg"></span>
                            <strong>SELECCIONAR</strong>
                        </button>
                        <input type="file" class="hide" name="letter-file">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-letter-upload">
                    <span class="fa fa-cloud-upload"></span>
                    Cargar
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="anexos-upload">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4><span>Cargar Anexos de la carta</span></h4>
            </div>
            <div class="modal-body">
                <div class="panel panel-warning">
                    <div class="panel-footer text-center">
                        <button type="button" class="btn btn-link text-black btn-open-letter-anexo-file">
                            <span class="fa fa-paperclip fa-lg"></span>
                            <strong>SELECCIONAR</strong>
                        </button>
                        <input type="file" class="hide" name="letter-anexos-file" multiple>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning text-black btn-upload-anexos">
                    <span class="fa fa-cloud-upload"></span>
                    Cargar
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" data-backdrop="static" id="letter-edit">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4 class="modal-title">
                    Editar carta
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">De</label>
                            <input type="text" class="form-control input-sm" name="letter-from-edit" placeholder="Quién envia?">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">Para</label>
                            <input type="text" class="form-control input-sm" name="letter-to-edit" placeholder="Quién recibe?">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">Estado</label>
                            <select class="form-control input-sm" name="letter-status-edit" placeholder="Estado">
                                <option value="PE">Pendiente</option>
                                <option value="EN">Enviado</option>
                                <option value="UP">Cardago</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">Observación</label>
                            <textarea name="letter-observation-edit" rows="2" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-default btn-sm pull-left">
                    <span class="fa fa-times"></span>
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary btn-sm edit-letter">
                    <span class="fa fa-save"></span>
                    Guardar Cambios
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="letter-observation">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-body">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4>Observación</h4>
                <small name="letter-observation"></small>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-xs btn-default">
                    <span class="fa fa-times"></span>
                    Salir
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="anexo-letter-list">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4 class="modal-title">
                    Lista de Anexos
                </h4>
            </div>
            <div class="modal-body">
                <ul class="list-group list-anexo"></ul>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-default btn-sm">
                    <span class="fa fa-times"></span>
                    Salir
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="closeProject" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4 class="modal-title">
                    Lista de Cierre de Proyecto
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="progress-project">
                            <div class="circle
                            {% if closure.storageclose %}
                                done
                            {% endif %}
                            ">
                                <span class="label">1</span>
                                <span class="title">Almacén</span>
                            </div>
                            <span class="bar
                            {% if closure.storageclose %}
                                active
                            {% endif %}
                            "></span>
                            <div class="circle
                            {% if closure.letterdelivery %}
                                done
                            {% endif %}
                            ">
                                <span class="label">2</span>
                                <span class="title">Operaciones</span>
                            </div>
                            <span class="bar
                            {% if closure.letterdelivery %}
                                active
                            {% endif %}
                            "></span>
                            <div class="circle
                            {% if closure.documents %}
                               done
                            {% endif %}
                            ">
                                <span class="label">3</span>
                                <span class="title">Documentos</span>
                            </div>
                            <span class="bar
                            {% if closure.documents %}
                               active
                            {% endif %}
                            "></span>
                            <div class="circle">
                                <span class="label">4</span>
                                <span class="title">Contabilidad</span>
                            </div>
                            <span class="bar"></span>
                            <div class="circle">
                                <span class="label">5</span>
                                <span class="title">Ventas</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="row">
                            <div class="col-md-12 height-content">
                                <strong>Cierre de Almacén
                                    <button class="btn btn-xs text-black btn-circle" value="one">
                                        <span class="fa fa-angle-double-down"></span>
                                    </button>
                                </strong>
                                <div>
                                    <div class="step-one">
                                        <small>
                                            El cierre de almacén de efectua cuando se a terminado de enviar todos los materiales a obra.
                                        </small>
                                        {% if user.get_profile.empdni.charge.area|lower == 'almacen' or user.get_profile.empdni.charge.area|lower == 'administrator' %}
                                            <p>
                                                {% if not closure.storageclose %}
                                                    <!-- <input type="text" class="form-control input-sm col-3" placeholder="Ingrese Código"> -->
                                                    <button class="btn btn-sm btn-success btn-close-storage">
                                                        <span class="glyphicon glyphicon-ok"></span>
                                                        Cerrar Almacén
                                                    </button>
                                                {% endif %}
                                            </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 height-content">
                                <strong>Envio de Carta de Entrega
                                    <button class="btn btn-xs text-black btn-circle" value="two">
                                        <span class="fa fa-angle-double-down"></span>
                                    </button>
                                </strong>
                                <div>
                                    <div class="step-two">
                                        <small>
                                            Carge la <strong><q>Carta de Entrega</q></strong> que se enviara al cliente. El archivo de preferencia debera ser pdf.
                                        </small>
                                        {% if user.get_profile.empdni.charge.cargos|lower == 'jefe de proyecto' or user.get_profile.empdni.charge.area|lower == 'administrator' %}
                                        <p>
                                            {% if not closure.letterdelivery %}
                                                <input type="file" accept="application/pdf" name="letterdelivery" class="form-control input-sm">
                                                <button class="btn btn-sm btn-success uploadletterclosep">
                                                    <span class="glyphicon glyphicon-upload"></span>
                                                    Cargar y Confirmar
                                                </button>
                                            {% endif %}
                                        </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 height-content">
                                <strong>Documentos de Cierre
                                    <button class="btn btn-xs text-black btn-circle" value="three">
                                        <span class="fa fa-angle-double-down"></span>
                                    </button>
                                </strong>
                                <div>
                                    <div class="step-three">
                                        <small>
                                            Carge los documentos que se entregaran al cliente y los que crea conveniente. el archivo a cargar devera ser un comprimirdo <q>rar</q>.
                                        </small>
                                        {% if user.get_profile.empdni.charge.area|lower == 'operaciones' or user.get_profile.empdni.charge.area|lower == 'administrator' %}
                                        <p>
                                            {% if not closure.documents %}
                                                <input type="file" accept="application/rar" name="documentsclosure" class="form-control input-sm" multiple>
                                                <button class="btn btn-sm btn-success btn-documents-closure">
                                                    <span class="glyphicon glyphicon-upload"></span>
                                                    Cargar y Confirmar
                                                </button>
                                            {% endif %}
                                        </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 height-content">
                                <strong>Valorizaciones, Facturas, Retenciones
                                    <button class="btn btn-xs text-black btn-circle" value="four">
                                        <span class="fa fa-angle-double-down"></span>
                                    </button>
                                </strong>
                                <div>
                                    <div class="step-four">
                                        {% if user.get_profile.empdni.charge.area|lower == 'logistica' or user.get_profile.empdni.charge.area|lower == 'administrator' %}
                                        <div class="">
                                            <div class="form-group">
                                                <label for="inputEmail3" class=" control-label">Total Facturado</label>
                                                <input type="text" name="closureamount" class="form-control input-sm" id="inputEmail3" placeholder="Total">
                                            </div>
                                            <div class="form-group">
                                                <label for="inputEmail3" class="control-label">Total IGV</label>
                                                <input type="text" class="form-control input-sm" name="closureiva" id="inputEmail3" placeholder="Total IGV">
                                            </div>
                                            <div class="form-group">
                                                <label for="inputEmail3" class=" control-label">Otros Ingresos</label>
                                                <input type="text" name="closureother" class="form-control input-sm" id="inputEmail3" placeholder="Otros ingresos">
                                            </div>
                                            <div class="form-group">
                                                <label for="inputEmail3" class=" control-label">Otras Salidas</label>
                                                <input type="text" class="form-control input-sm" name="closureout" id="inputEmail3" placeholder="Otros ingresos">
                                            </div>
                                            <div class="form-group">
                                                <label for="inputEmail3" class=" control-label">Retención</label>
                                                <input type="text" class="form-control input-sm" id="inputEmail3" name="closureretention" placeholder="Retención">
                                            </div>
                                             <div class="form-group">
                                                <label for="inputEmail3" class=" control-label">Archivos <span>(Opcional)</span></label>
                                                <input type="file" name="accountingfiles" class="form-control input-sm" id="inputEmail3" placeholder="Retención">
                                            </div>
                                        </div>
                                        <p>
                                            <button class="btn btn-success btn-xs btn-closure-accounting">
                                                <span class="fa fa-save"></span>
                                                Guardar Cambios
                                            </button>
                                        </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 height-content">
                                <strong>
                                    Cierre de Proyecto
                                    <button class="btn btn-xs text-black btn-circle" value="five">
                                        <span class="fa fa-angle-double-down"></span>
                                    </button>
                                </strong>
                                <div>
                                    <div class="step-five">
                                        <small>
                                            Solicite el código, solo si las demás tareas ya ha sido realizadas.
                                        </small>
                                        {% if user.get_profile.empdni.charge.area|lower == 'administrator' or user.get_profile.empdni.charge.area|lower == 'ventas' %}
                                            <p>
                                                <button class="btn btn-link btn-xs text-black">
                                                    <span class="fa fa-key"></span>
                                                    Obtener Código
                                                </button>
                                                <p>
                                                    <input type="text" class="form-control input-sm col-2">
                                                    <button class="btn btn-sm btn-success">
                                                        <span class="fa fa-save"></span>
                                                        Cerrar Proyecto
                                                    </button>
                                                </p>
                                            </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end block -->
{% csrf_token %}
<input type="hidden" name="dni" value="{{ user.get_profile.empdni_id }}">
<!-- status project -->
<input type="hidden" name="status-project" value="{{ project.status }}">
<input type="hidden" name="user-email" value="{{ user.email }}" data-name="{{ user.get_profile.empdni.firstname }} {{ user.get_profile.empdni.lastname }}">
<input type="hidden" name="companyname" value="{{ request.session.company.name }}" data-phone="{{ request.session.company.phone }}">
<!-- block tree file -->
<script src="{{ MEDIA_URL }}js/jquery.easing.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/jqueryFileTree.js" type="text/javascript"></script>
<link href="{{ MEDIA_URL }}css/jqueryFileTree.css" rel="stylesheet" type="text/css" media="screen" />
{% endblock content %}