{% extends "base.html" %}
{% block title %}
    Manager Project
{% endblock title %}
{% block style %}
<link rel="stylesheet" href="{{ MEDIA_URL }}css/sales/managerpro.css">
{% endblock style %}
{% block script %}
<script src="{{ MEDIA_URL }}js/tinymce.js"></script>
<script src="{{ MEDIA_URL }}js/mustache.js"></script>
<script src="{{ MEDIA_URL }}js/sales/managerpro.js"></script>
<script>
equalheight = function(container){
    var currentTallest = 0,
    currentRowStart = 0,
    rowDivs = new Array(),
    $el,
    topPosition = 0;
    $(container).each(function() {
        $el = $(this);
        $($el).height('auto')
        topPostion = $el.position().top;

        if (currentRowStart != topPostion) {
            for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
            rowDivs[currentDiv].height(currentTallest);
        }
        rowDivs.length = 0; // empty the array
        currentRowStart = topPostion;
        currentTallest = $el.height();
            rowDivs.push($el);
        } else {
            rowDivs.push($el);
            currentTallest = (currentTallest < $el.height()) ? ($el.height()) : (currentTallest);
        }
        for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
            rowDivs[currentDiv].height(currentTallest);
        }
    });
}
$(window).load(function() {
    equalheight('.all-sectors article');
});
$(window).resize(function(){
    equalheight('.all-sectors article');
});
</script>
{% endblock script %}
{% block menu %}
    {% include "menus/sale.htm" %}
{% endblock menu %}
{% block content %}
<div class="container">
    <div class="well">
        <h3>
            Administrador de Proyecto
            <br>
            <a href="{% url 'view_projects' %}" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-chevron-left"></span> Regresar
            </a>
        </h3>
        <div class="row">
            <div class="col-md-3">
                <div class="panel panel-primary panel-manager">
                    <div class="panel-body">
                        <h4>Sectores y Subproyectos</h4>
                        <hr>
                        <div class="panel-group" id="accordion">
                            <div class="panel panel-primary sector-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion" href="#default">
                                          Proyecto Default
                                        </a>
                                    </h4>
                                </div>
                                <div id="default" class="panel-collapse collapse in">
                                  <div class="panel-body">
                                    <ul class="sectors sectorsdefault">
                                        {% for x in sectors %}
                                            {% ifequal x.subproyecto_id None %}
                                                <li>
                                                    <a href="{% url 'managersec_view' x.proyecto_id x.subproyecto_id x.sector_id %}" class="text-black">
                                                        <span class="glyphicon glyphicon-chevron-right"></span>
                                                        {{ x.nomsec }}
                                                    </a>
                                                </li>
                                            {% endifequal %}
                                        {% endfor %}
                                    </ul>
                                  </div>
                                </div>
                            </div>
                            {% for x in subpro %}
                                <div class="panel panel-primary" data-sub="{{ x.subproyecto_id }}">
                                    <div class="panel-heading">
                                      <h5 class="panel-title">
                                        <a class="text-{{ x.subproyecto_id }}" data-toggle="collapse" data-parent="#accordion" href="#{{ x.subproyecto_id }}">
                                            {{ x.nomsub }}
                                        </a>
                                      </h5>
                                    </div>
                                    <div id="{{ x.subproyecto_id }}" class="panel-collapse collapse">
                                        <div class="panel-footer">
                                            <div class="btn-group btn-group-justified">
                                                <div class="btn-group">
                                                    <button class="btn btn-xs btn-default text-black btn-edit-sub" value="{{ x.subproyecto_id }}"><span class="glyphicon glyphicon-pencil"></span></button>
                                                </div>
                                                <div class="btn-group">
                                                    <button class="btn btn-xs btn-default text-black btn-del-sub" value="{{ x.subproyecto_id }}"><span class="glyphicon glyphicon-trash"></span></button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="panel-body">
                                            <ul class="sectors sectors{{ x.subproyecto_id }}">
                                                {% for j in sectors %}
                                                    {% ifequal x.subproyecto_id j.subproyecto_id  %}
                                                        <li><a href="{% url 'managersec_view' j.proyecto_id j.subproyecto_id j.sector_id %}" class="text-black"><span class="glyphicon glyphicon-chevron-right"></span> {{ j.nomsec }}</a></li>
                                                    {% endifequal %}
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-9">
                <div class="panel panel-primary panel-manager">
                    <div class="panel-body">
                        <input type="hidden" name="pro" value="{{ project.proyecto_id }}">
                        <input type="hidden" name="sub" value="">
                        <div class="header-project">
                            <p>
                                <strong>Proyecto :</strong> {{ project.nompro }}
                                <strong> Codigo :</strong> {{ project.proyecto_id}}
                            </p>
                            <p>
                                <strong>Dirección: </strong> {{ project.direccion }}
                            </p>
                            {% if project.empdni_id %}
                                <p>
                                    <strong>Responsable :</strong> {{ project.empdni.name_complete }} {{ project.empdni.name_charge }}
                                </p>
                            {% endif %}
                        </div>
                        <div class="btn-group btn-group-justified">
                            <div class="btn-group">
                                <button class="btn btn-primary btn-xs new-sector
                                {% if project.status == 'AC' %}
                                    hide
                                {% endif %}
                                ">
                                    <span class="glyphicon glyphicon-th"></span>
                                    <span class="visible-lg visible-md">Nuevo Sector</span>
                                </button>
                            </div>
                            {% if project.status != 'PE' %}
                                <div class="btn-group">
                                    <button class="btn btn-primary btn-xs new-subproject
                                    {% if project.status == 'AC' %}
                                        hide
                                    {% endif %}">
                                        <span class="glyphicon glyphicon-th-large"></span>
                                        <span class="visible-lg visible-md">Nuevo Subproyeto</span>
                                    </button>
                                </div>
                            {% endif %}
                            <div class="btn-group">
                                <button class="btn btn-primary btn-xs btn-responsible
                                {% if project.status == 'AC' %}
                                    hide
                                {% endif %}">
                                    <span class="glyphicon glyphicon-user"></span>
                                    <span class="visible-lg visible-sm">Responsable</span>
                                </button>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-primary btn-xs btn-files
                                {% if project.status == 'AC' %}
                                    hide
                                {% endif %}">
                                    <span class="glyphicon glyphicon-compressed"></span>
                                    <span class="visible-lg visible-sm">Archivos</span>
                                </button>
                            </div>
                            <div class="btn-group">
                                <button data-toggle="modal" data-target="#mapprove" class="btn btn-danger btn-xs btn-approve
                                {% if project.status == 'AC' %}
                                    hide
                                {% endif %}">
                                    <span class="glyphicon glyphicon-saved"></span>
                                    <span class="visible-lg visible-sm">Aprobar</span>
                                </button>
                            </div>
                            <div class="btn-group">
                                <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown">
                                    <span class="caret"></span>
                                    <span class="visible-lg visible-md">Vista</span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li>
                                        <a class="btn-cuadro"><span class="glyphicon glyphicon-th"></span> Cuadros</a></li>
                                    <li>
                                        <a class="btn-list"><span class="glyphicon glyphicon-align-justify"></span> Lista</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <hr>
                        <div class="all-sectors">
                            {% for x in sectors %}
                                {% ifequal x.subproyecto_id None  %}
                                    <article>
                                        <button class="btn btn-xs text-black btn-link pull-left btn-edit-sector
                                        {% if project.status == 'AC' %}
                                            hide
                                        {% endif %}"
                                        value="{{ x.sector_id }}">
                                            <span class="glyphicon glyphicon-pencil"></span>
                                        </button>
                                        <button class="btn btn-xs text-black btn-link pull-right
                                        {% if project.status == 'AC' %}
                                            hide
                                        {% endif %}
                                        " value="{{ x.sector_id }}">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </button>
                                        <a href="{% url 'managersec_view' x.proyecto_id x.subproyecto_id x.sector_id %}" class="text-black">
                                            {{ x.sector_id }}
                                            {{ x.nomsec }}
                                            <small>{{ x.planoid }}</small>
                                        </a>
                                    </article>
                                {% endifequal %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-8">
                        <div class="panel panel-default panel-comment comment-list">
                            <div class="panel-heading   ">
                                <h6>Comentarios</h6>
                                <button class="close btn-show-comment"><span class="glyphicon glyphicon-chevron-up"></span></button>
                            </div>
                            <div class="panel-body">
                                {% for x in alerts %}
                                    <div class="alert alert-{{ x.status }} comment{{ x.id }}">
                                            <div>
                                                {% ifequal x.empdni_id user.get_profile.empdni_id %}
                                                    <div class="btn-group pull-right">
                                                        <button type="button" data-toggle="dropdown" class="btn btn-xs btn-link text-black dropdown-toggle"><span class="glyphicon glyphicon-collapse-down"></span></button>
                                                        <ul role="menu" class="dropdown-menu">
                                                            <li><a data-status="{{ x.status }}" data-id="{{ x.id }}" class="btn-message-edit">Editar</a></li>
                                                            <!-- <li><a data-status="{{ x.status }}" data-id="{{ x.id }}" class="btn-message-del">Eliminar</a></li> -->
                                                        </ul>
                                                    </div>
                                                {% endifequal %}
                                                <small>{{ x.registrado }}</small>
                                            </div>
                                            <div>
                                                {{ x.message|safe }}
                                            </div>
                                            <div>
                                                <small class="pull-right">{{ x.empdni.firstname }} {{ x.empdni.lastname }} - {{ x.charge.area }}</small>
                                            </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-default panel-comment">
                            <div class="panel-heading">
                                <h6>Publicar Comentario</h6>
                            </div>
                            <div class="panel-body">
                                <textarea maxlength="250" name="message" id="message" rows="1" class="form-control"></textarea>
                                <div class="form-group">
                                    <select name="message-status" id="message-status" class="form-control">
                                        <option value="success">Normal</option>
                                        <option value="warning">Importante</option>
                                        <option value="danger">Error</option>
                                    </select>
                                </div>
                                <input type="hidden" name="edit-message">
                                <button class="btn btn-success bt-sm btn-publisher"><span class="glyphicon glyphicon-comment"></span> Publicar</button><span>
                                    <h6><small> Maximo de caracteres 250.</small></h6>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="row">
                    {% if user.get_profile.empdni.charge.area|lower == 'administrator' or user.get_profile.empdni.charge.area|lower == 'ventas' %}
                    <div class="col-md-6">
                        <div class="panel panel-primary">
                            <div class="panel-footer">
                                <strong>Archivos Admisitrativos</strong>
                            </div>
                            <div class="panel-body">
                                <div id="filetree_administrative"></div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    <div class="col-md-6">
                        <div class="panel panel-primary">
                            <div class="panel-footer">
                                <strong>Archivos Operaciones</strong>
                            </div>
                            <div class="panel-body">
                                <div id="filetree_operation"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- block modal -->
<div class="modal fade mresponsible">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4 class="modal-title">Responsable de proyecto.</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="control-label">Operaciones</label>
                    <select name="responsible" id="responsible" class="form-control input-sm">
                        {% for x in operation %}
                            <option value="{{ x.empdni_id }}">{{ x.name_complete }}</option>
                        {% empty %}
                            <option value="">-- Nothing --</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label class="control-label">Administrador</label>
                    <select name="admin" id="admin" class="form-control input-sm">
                        {% for x in admin %}
                            <option value="{{ x.empdni_id }}">{{ x.name_complete }}</option>
                        {% empty %}
                            <option value="">-- Nothing --</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label class="control-label">Password Administrador</label>
                    <input type="password" class="form-control input-sm" name="passwd">
                </div>
            </div>
            <div class="modal-footer">
                <button data-dismiss="modal" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span> Cancelar</button>
                <button class="btn btn-primary btn-assigned"><span class="glyphicon glyphicon-floppy-disk"></span> Guardar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade mfiles" data-backdrop="static">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <a data-dismiss="modal" class="close">&times;</a>
                <h4>Subir Archivos</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="control-label">Administrativos</label>
                    <div class="alert alert-inverse alert-inverse-border alert-block text-center">
                        <button class="btn btn-xs btn-link btn-admin">Click Aquí</button>
                        <input type="file" class="hide" name="administrative">
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label">Operaciones</label>
                    <div class="alert alert-inverse alert-inverse-border alert-block text-center">
                        <button class="btn btn-xs btn-link btn-opera">Click Aquí</button>
                        <input type="file" class="hide" name="operation">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button data-dismiss="modal" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span> Cancelar</button>
                <button class="btn btn-primary btn-upload-files"><span class="glyphicon glyphicon-upload"></span> Subir</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade mapprove" id="mapprove" data-backdrop="static">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header brand-danger">
                <h4 class="modal-title">
                    Aprobar Proyecto para Ejecución
                </h4>
            </div>
            <div class="modal-body brand-danger">
                <p>
                    <strong>Importante!</strong> este paso solo se debe seguir si esta seguro que a terminado de ingresar los archivos y las listas de materiales a los respectivos sectores.
                </p>
                <p>
                    Desea continuar con la aprobación del proyecto?
                </p>
                <p>
                    <div class="form-group">
                        <label class="control-label">Administrador</label>
                        <select name="admin-approve" id="admin-approve" class="form-control input-sm">
                            {% for x in admin %}
                                <option value="{{ x.empdni_id }}">{{ x.name_complete }}</option>
                            {% empty %}
                                <option value="">-- Nothing --</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Password</label>
                        <input type="password" class="form-control input-sm" name="passwd-approve">
                    </div>
                </p>
                <p>
                    <button data-dismiss="modal" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span> Cancelar</button>
                    <button class="btn btn-danger pull-right btn-approved"><span class="glyphicon glyphicon-saved"></span> Aprobar</button>
                </p>
            </div>
        </div>
    </div>
</div>
<!-- end block -->
{% csrf_token %}
<input type="hidden" name="dni" value="{{ user.get_profile.empdni_id }}">
<!-- status project -->
<input type="hidden" name="status-project" value="{{ project.status }}">
<!-- block tree file -->
<script src="{{ MEDIA_URL }}js/jquery.easing.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/jqueryFileTree.js" type="text/javascript"></script>
<link href="{{ MEDIA_URL }}css/jqueryFileTree.css" rel="stylesheet" type="text/css" media="screen" />
{% endblock content %}